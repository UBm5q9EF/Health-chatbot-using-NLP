<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Healtho - AI Health Chatbot</title>
  <link rel="stylesheet" href="/static/style.css" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet" />
</head>
<body>
  <div class="chat-shell">
    <header class="chat-header">
      <div class="brand">
        <img src="https://pinnacle.works/wp-content/uploads/2019/10/health-bot.png" alt="Healtho Logo" />
        <div class="titles">
          <h1>Healtho</h1>
          <p>Your AI Healthcare Assistant</p>
        </div>
      </div>
    </header>

    <main id="chat-box" class="chat-box"></main>

    <div id="typing-indicator" class="typing hidden">
      <span class="dot"></span><span class="dot"></span><span class="dot"></span>
      <span class="typing-text">Bot is typingâ€¦</span>
    </div>

    <footer class="chat-input">
      <input type="text" id="user-input" placeholder="Type your messageâ€¦" autocomplete="off" />
      <button id="send-btn" class="btn">Send</button>
      <button id="mic-btn" class="btn mic" title="Speak">ðŸŽ¤</button>
    </footer>
  </div>

  <script>
    const chatBox = document.getElementById("chat-box");
    const typing = document.getElementById("typing-indicator");
    const input = document.getElementById("user-input");
    const sendBtn = document.getElementById("send-btn");
    const micBtn = document.getElementById("mic-btn");

    function bubble(from, text) {
      const msg = document.createElement("div");
      msg.className = `msg ${from.toLowerCase()}`;
      msg.innerHTML = `
        <div class="avatar">${from === "Bot" ? "ðŸ¤–" : "ðŸ‘¤"}</div>
        <div class="bubble">${text}</div>
      `;
      chatBox.appendChild(msg);
      chatBox.scrollTop = chatBox.scrollHeight;
    }

    async function sendMessage() {
      const text = input.value.trim();
      if (!text) return;

      bubble("User", text);
      input.value = "";

      typing.classList.remove("hidden");

      try {
        const res = await fetch("/api/chat", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ input: text })
        });
        const data = await res.json();
        typing.classList.add("hidden");
        bubble("Bot", data.reply);
      } catch (e) {
        typing.classList.add("hidden");
        bubble("Bot", "âš ï¸ Something went wrong. Please try again.");
      }
    }

    input.addEventListener("keydown", (e) => {
      if (e.key === "Enter") sendMessage();
    });

    sendBtn.addEventListener("click", sendMessage);

    // ðŸ‘‹ Auto-greeting from bot
    window.onload = () => {
      bubble("Bot", "Hi! How are you feeling today?");
      input.focus();
    };

    // ðŸŽ¤ Voice input using Web Speech API
    micBtn.addEventListener("click", () => {
      const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
      if (!SR) return alert("ðŸŽ¤ Speech recognition not supported in this browser.");

      const recog = new SR();
      recog.lang = "en-US";
      recog.interimResults = false;
      recog.maxAlternatives = 1;

      recog.onresult = (e) => {
        const said = e.results[0][0].transcript;
        input.value = said;
        sendMessage();
      };

      recog.onerror = () => {
        bubble("Bot", "I couldn't hear you clearly. Please try again.");
      };

      recog.start();
    });
  </script>
</body>
</html>
